<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fivee Snippets Demo</title>
    <style>
      body {
        font-family: sans-serif;
        margin: 0;
      }

      input[type="text"],
      select {
        border: 1px solid grey;
        font-size: 1rem;
        border-radius: 0.2rem;
        padding: 0.125rem 0.25rem;
      }

      form {
        padding: 1rem;
        margin: 0;
      }

      form fieldset {
        max-width: fit-content;
        border: 1px solid grey;
        border-radius: 0.2rem;
        margin-bottom: 0.5rem;
      }

      form > label {
        display: flex;
        margin-bottom: 0.5rem;
        gap: 0.5rem;
        width: 45ch;
        align-items: center;
      }

      form label input:not([type="radio"]) {
        flex-grow: 1;
      }

      fieldset label {
        display: block;
        margin-right: 0.5rem;
      }

      fieldset label + label {
        margin-top: 0.5rem;
      }

      #output {
        border: 2px solid black;
        padding: 1rem;
        margin: 1rem;
        width: fit-content;
      }
    </style>

    <link id="themeLink" rel="stylesheet" href="" />

    <link rel="stylesheet" href="./tw-reset.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        corePlugins: {
          preflight: false,
        },
        important: true,
      };
    </script>
  </head>
  <body>
    <form id="query" onchange="handleChange()">
      <label>
        Snippets URL:
        <input
          type="text"
          name="snippetsURL"
          id="snippetsURL"
          value="http://localhost:8000/snippets"
        />
      </label>
      <label>
        Snippet Type:
        <select name="snippetType" id="snippetType">
          <option value="spell-card">spell card</option>
        </select>
      </label>
      <label>
        Document:
        <input type="text" name="documentId" id="documentId" value="wish" />
      </label>
      <fieldset>
        <legend>CSS Mode:</legend>
        <label>
          <input type="radio" id="cssModeBEM" name="cssMode" value="bem" />
          BEM ("bem")
        </label>
        <label>
          <input
            type="radio"
            id="cssModeTailwind"
            name="cssMode"
            value="tw"
            checked
          />
          TailwindCSS ("tw")
        </label>
      </fieldset>
      <label>
        Theme:
        <select name="theme">
          <option value="default" selected>Default</option>
          <option value="none">None</option>
        </select>
      </label>
      <label>
        Expressions:
        <select name="expressions">
          <option value="text" selected>Text</option>
          <option value="html">HTML</option>
          <option value="interactive">Interactive HTML</option>
        </select>
      </label>
    </form>
    <div id="output"></div>

    <script>
      function handleChange() {
        const $output = document.querySelector("#output");
        const $themeLink = document.querySelector("#themeLink");
        const $query = document.querySelector("#query");

        const form = new FormData($query);
        const snippetsURL = form.get("snippetsURL");
        const snippetType = form.get("snippetType");
        const documentId = form.get("documentId");
        const cssMode = form.get("cssMode");
        const theme = form.get("theme");
        const expressions = form.get("expressions");

        if (documentId === null || documentId === "") return;

        fetch(
          `${snippetsURL}/${snippetType}/${documentId}?cssMode=${cssMode}&twTheme=${theme}&expressions=${expressions}`
        )
          .then((res) => res.text())
          .then((html) => {
            $output.innerHTML = html;

            if (cssMode === "bem") {
              $themeLink.href =
                theme === "none" ? "" : `${snippetsURL}/styles/${theme}.css`;
            }

            $output.classList.toggle("tw-reset", cssMode === "tw");
          })
          .catch((err) => {
            console.error(err);
            $output.textContent = err.toString();
          });
      }

      handleChange();
    </script>
  </body>
</html>
